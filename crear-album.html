<!-- crear-album.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Crear Álbum – Zolian App</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <section class="home" style="max-width:400px; margin:0 auto; padding:20px;">
    <h1>Crear nuevo álbum</h1>
    <input
      type="text"
      id="album-name"
      placeholder="Nombre del álbum"
      style="width:100%; padding:8px; margin-top:12px;"
    />
    <button
      id="create-btn"
      style="margin-top:16px; padding:10px; background:#695CFE; color:#fff;"
    >
      Crear Álbum
    </button>
    <p id="msg" style="color:red; min-height:1.2em;"></p>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
  <script src="/supabaseClient.js"></script>
  <script>
    (async () => {
      // 1) Sesión
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) {
        location.href = 'login.html?redirect=/crear-album.html';
        return;
      }

      // 2) Obtener referencia al botón
      const btn = document.getElementById('create-btn');
      const msg = document.getElementById('msg');

      // 3) Listener
      btn.onclick = async () => {
        msg.textContent = ''; // limpia mensaje
        const name = document.getElementById('album-name').value.trim();
        if (!name) {
          msg.textContent = 'Debes poner un nombre.';
          return;
        }

        // 4) Inserción en Supabase
        const { data, error } = await supabase
          .from('galleries')
          .insert({ name, user_id: session.user.id })
          .single();

        if (error) {
          console.error(error);
          msg.textContent = 'Error al crear el álbum.';
        } else {
          // 5) Redirigir a administrar
          location.href = `/album.html?gallery=${data.id}`;
        }
      };
    })();
  </script>
</body>
</html>
