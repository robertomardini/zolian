<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Administrar Álbum</title>
  <link rel="stylesheet" href="style.css">
  <script src="supabaseClient.js"></script>
</head>
<body>
  <h1>Selecciona un Álbum</h1>
  <div id="albums" style="margin:2rem;"></div>

  <script>
    const supabase = window.supabase;
    const params   = new URLSearchParams(window.location.search);
    const screenId = params.get('code');

    (async () => {
      // 1) Verifica sesión
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return window.location.href = '/login.html';

      // 2) Trae los álbumes de quien está logueado
      const { data: albums, error } = await supabase
        .from('albums')
        .select('id, name')
        .eq('user_id', user.id)
        .order('name');
      if (error) return console.error('Error al cargar álbumes:', error);

      // 3) Dibuja un botón por álbum
      const cont = document.getElementById('albums');
      albums.forEach(a => {
        const btn = document.createElement('button');
        btn.textContent = a.name;
        btn.style = 'display:block; margin:.5rem 0; padding:.5rem 1rem;';
        btn.onclick = async () => {
          const { error: e2 } = await supabase
            .from('screens')
            .update({ current_album_id: a.id })
            .eq('id', screenId);
          if (e2) return console.error(e2);
          alert('Álbum seleccionado correctamente.');
        };
        cont.appendChild(btn);
      });
    })();
  </script>
</body>
</html>
