<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Vincular Pantalla</title>
  <link rel="stylesheet" href="style.css">
  <script src="supabaseClient.js"></script>
</head>
<body>
  <h1>Vincular Pantalla</h1>
  <div style="margin:2rem;">
    <label for="name">Nombre de la pantalla:</label><br>
    <input type="text" id="name" placeholder="Ej: Sala 1" style="width:100%; padding:.5rem;">
    <button id="submit" style="margin-top:1rem; padding:.5rem 1rem;">OK</button>
  </div>

  <script>
    const supabase = window.supabase;
    const params   = new URLSearchParams(window.location.search);
    const screenId = params.get('code');
    if (!screenId) alert('Falta el parámetro code en la URL.');

    // Asegúrate de que quien entra aquí está logueado
    (async () => {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) window.location.href = '/login.html';
    })();

    document.getElementById('submit').addEventListener('click', async () => {
      const nombre = document.getElementById('name').value.trim();
      if (!nombre) return alert('Por favor ingresa un nombre.');
      // Actualiza el registro con el nombre
      const { error } = await supabase
        .from('screens')
        .update({ name: nombre })
        .eq('id', screenId);
      if (error) return console.error('Error al guardar nombre:', error);

      // Lleva a la pantalla de administrar
      window.location.href = `/administrar.html?code=${screenId}`;
    });
  </script>
</body>
</html>
