<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Slideshow de Prueba</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- 1) Carga la librería UMD de Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <!-- 2) Tu cliente que sobrescribe window.supabase -->
  <script src="js/supabaseClient.js"></script>
  <style>
    body { 
      margin: 0; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      justify-content: center; 
      min-height: 100vh; 
      background: #111; 
      color: #fff;
    }
    img {
      max-width: 90vw;
      max-height: 80vh;
      border: 4px solid #fff;
      border-radius: 8px;
      box-shadow: 0 0 12px rgba(0,0,0,0.5);
    }
    h1 { margin-bottom: 1rem; }
  </style>
</head>
<body>
  <h1>Slideshow de Prueba</h1>
  <div id="slideshow-container">
    <!-- Aquí se inyectará la etiqueta <img> -->
  </div>

  <script>
  (async () => {
    // ---- CONFIGURA AQUÍ tu prefijo de prueba ----
    const prefix = '3a5d70f7-54aa-4aa1-97dd-cc7ba4fd8e1c/5Q6EL4';
    const bucket  = 'tv-content';

    // 1) Listar ficheros en el bucket bajo ese prefijo
    const { data: files, error: listErr } = await supabase
      .storage
      .from(bucket)
      .list(prefix);

    if (listErr) {
      console.error('Error listando archivos:', listErr);
      document
        .getElementById('slideshow-container')
        .innerText = 'Error al listar imágenes. Mira la consola.';
      return;
    }
    if (!files.length) {
      console.warn('No hay imágenes bajo el prefijo:', prefix);
      document
        .getElementById('slideshow-container')
        .innerText = 'No se encontraron imágenes para este TV.';
      return;
    }

    // 2) Obtener las URLs públicas
    const urls = files.map(f => {
      const { data: { publicUrl } } = supabase
        .storage
        .from(bucket)
        .getPublicUrl(`${prefix}/${f.name}`);
      return publicUrl;
    });

    // 3) Construir la etiqueta <img> y arrancar slideshow
    let idx = 0;
    const imgEl = document.createElement('img');
    imgEl.src = urls[0];        // imagen inicial
    document
      .getElementById('slideshow-container')
      .appendChild(imgEl);

    setInterval(() => {
      idx = (idx + 1) % urls.length;
      imgEl.src = urls[idx];
    }, 3000);
  })();
  </script>
</body>
</html>
